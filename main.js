(()=>{"use strict";var e={url:"https://mesto.nomoreparties.co/v1/wbf-cohort-5",headers:{"Content-Type":"application/json",authorization:"96531009-4ee7-4854-9cab-762893291a9b"}};var t,r,o,n=document.querySelector(".root"),c=document.querySelector(".page"),a=document.querySelector(".content"),i=c.querySelector(".popup_type_edit-profile"),u=a.querySelector(".profile__btn-edit"),l=i.querySelector(".form"),s=l.querySelector(".form__input_type_profile-name"),_=l.querySelector(".form__input_type_profile-description"),p=i.querySelector(".popup__btn_type_form"),d=i.querySelector(".popup__error"),f=a.querySelector(".profile__title"),v=a.querySelector(".profile__subtitle"),y=c.querySelector(".popup_type_update-avatar"),m=a.querySelector(".profile__avatar-btn-add"),h=a.querySelector(".profile__avatar"),S=y.querySelector(".form"),q=y.querySelector(".form__input_type_avatar-url"),b=y.querySelector(".popup__btn_type_form"),k=y.querySelector(".popup__error"),E=m.querySelector(".loader_type_avatar"),L=c.querySelector(".popup_type_add-photo"),C=a.querySelector(".profile__btn-add"),g=L.querySelector(".form"),x=L.querySelector(".form__input_type_photo-name"),j=L.querySelector(".form__input_type_photo-url"),P=L.querySelector(".popup__btn_type_form"),T=L.querySelector(".popup__error"),A=a.querySelector(".gallery__cards"),w=document.querySelector("#card-item-template").content,B=c.querySelector(".popup_type_viewer-photo"),D=B.querySelector(".viewer__photo"),N=B.querySelector(".viewer__caption"),O=c.querySelector(".popup_type_confirm"),J=O.querySelector(".popup__btn_type_confirm"),G=O.querySelector(".popup__error"),H={formSelector:".form",inputSelector:".form__input",inputErrorClass:"form__input_error",textErrorClass:"form__error_active",submitButtonSelector:".popup__btn_type_form",inactiveButtonClass:"popup__btn_disabled"};function M(e,t,r){e.textContent=r,e.disabled=!!t&&"disabled"}function z(e,t){M(e,t,t?"Сохранение...":"Сохранить")}function U(e){e.classList.add("loader_visible")}function V(e){e.classList.remove("loader_visible")}function F(e){e.src="9b82276c5760c55b592e.webp"}function I(e,t,r){e.classList.add(t),e.textContent=r}function K(e,t){e.classList.remove(t),e.textContent=""}function Q(e){"Escape"===e.key&&W(c.querySelector(".popup_opened"))}function R(e){e.classList.add("popup_opened"),n.classList.add("root_popup-open"),document.addEventListener("keydown",Q)}function W(e){e.classList.remove("popup_opened"),n.classList.remove("root_popup-open"),document.removeEventListener("keydown",Q)}function X(e,t){return e.owner._id===t}function Y(e,t,r,o,n){var c=w.querySelector(".card").cloneNode(!0);e.element=c;var a=c.querySelector(".card__photo"),i=c.querySelector(".card__text"),u=c.querySelector(".card__btn-like"),l=c.querySelector(".card__like-counter"),s=c.querySelector(".card__btn-delete"),_=c.querySelector(".loader_type_card");return a.onload=function(){return V(_)},a.onerror=function(){return F(a)},U(a),a.src=e.link,a.setAttribute("alt",e.name),i.textContent=e.name,l.textContent=e.likes.length,function(e,t){return e.likes.some((function(e){return e._id===t}))}(e,t)&&u.classList.add("card__btn-like_active"),X(e,t)?s.addEventListener("click",(function(){o(e,c)})):s.remove(),a.addEventListener("click",(function(){r(e)})),u.addEventListener("click",(function(){n(e,c,u.classList.contains("card__btn-like_active"))})),c}function Z(e,t){var r=e.querySelector(".card__btn-like"),o=e.querySelector(".card__like-counter");r.classList.toggle("card__btn-like_active"),o.textContent=t.length}function $(e,t,r){e.classList.remove(r.inputErrorClass),t.classList.remove(r.textErrorClass),t.textContent=e.validationMessage}function ee(e,t,r){t?(e.disabled=!1,e.classList.remove(r.inactiveButtonClass)):(e.disabled="disabled",e.classList.add(r.inactiveButtonClass))}function te(e,t){e.querySelectorAll(".form__input").forEach((function(r){$(r,e.querySelector(".".concat(r.id,"-error")),t)}))}function re(e){D.src=e.link,D.setAttribute("alt",e.name),N.textContent=e.name,R(B)}function oe(e,o){t=e,r=o,K(G,"popup__error_active"),R(O)}function ne(t,r,o){var n,c=r.querySelector(".card__error-like");o?(n=t._id,fetch("".concat(e.url,"/cards/likes/").concat(n),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка удаления лайка: ".concat(e.status,"."))}))).then((function(e){Z(r,e.likes)})).catch((function(e){console.log(e),I(c,"card__error-like_active",e)})).finally((function(){setTimeout((function(){return K(c,"card__error-like_active")}),1500)})):function(t){return fetch("".concat(e.url,"/cards/likes/").concat(t),{method:"PUT",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка установки лайка: ".concat(e.status,"."))}))}(t._id).then((function(e){Z(r,e.likes)})).catch((function(e){console.log(e),I(c,"card__error-like_active",e)})).finally((function(){setTimeout((function(){return K(c,"card__error-like_active")}),1500)}))}function ce(e){f.textContent=e}function ae(e){v.textContent=e}function ie(e){h.onload=function(){return V(E)},h.onerror=function(){return F(h)},U(E),h.src=e}c.querySelectorAll(".popup").forEach((function(e){e.querySelector(".popup__btn-close").addEventListener("click",(function(){return W(e)})),e.addEventListener("mousedown",(function(t){t.target===e&&W(e)}))})),J.addEventListener("click",(function(){var o;M(J,!0,"Удаление..."),K(G,"popup__error_active"),(o=t._id,fetch("".concat(e.url,"/cards/").concat(o),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка удаления карточки: ".concat(e.status,". Попробуйте ещё раз."))}))).then((function(){r.remove(),W(O)})).catch((function(e){console.log(e),I(G,"popup__error_active",e)})).finally((function(){return M(J,!1,"Да")}))})),Promise.all([fetch("".concat(e.url,"/users/me"),{method:"GET",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка отображения данных: ".concat(e.status,". Попробуйте перезагрузить страницу."))})),fetch("".concat(e.url,"/cards"),{method:"GET",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка отображения данных: ".concat(e.status,". Попробуйте перезагрузить страницу."))}))]).then((function(e){var t=e[0];o=t._id,ie(t.avatar),ce(t.name),ae(t.about),e[1].filter((function(e){return X(e,o)})).forEach((function(e){var t=Y(e,o,re,oe,ne);A.append(t)}))})).catch((function(e){console.log(e),function(e){a.classList.add("content_inactive");var t=document.createElement("section");t.classList.add("content__error"),t.textContent=e,a.prepend(t)}(e)})),u.addEventListener("click",(function(){s.value=f.textContent,_.value=v.textContent,te(l,H),K(d,"popup__error_active"),ee(p,!1,H),R(i)})),l.addEventListener("submit",(function(t){var r,o;t.preventDefault(),z(p,!0),K(d,"popup__error_active"),(r=s.value,o=_.value,fetch("".concat(e.url,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:r,about:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка обновления профиля: ".concat(e.status,". Попробуйте ещё раз."))}))).then((function(e){ce(e.name),ae(e.about),W(i)})).catch((function(e){console.log(e),I(d,"popup__error_active",e)})).finally((function(){z(p,!1)}))})),m.addEventListener("click",(function(){S.reset(),te(S,H),K(k,"popup__error_active"),ee(b,!1,H),R(y)})),S.addEventListener("submit",(function(t){var r;t.preventDefault(),z(b,!0),K(k,"popup__error_active"),(r=q.value,fetch("".concat(e.url,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:r})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка обновления аватара: ".concat(e.status,". Попробуйте ещё раз."))}))).then((function(e){W(y),ie(e.avatar)})).catch((function(e){console.log(e),I(k,"popup__error_active",e)})).finally((function(){z(b,!1)}))})),C.addEventListener("click",(function(){g.reset(),te(g,H),K(T,"popup__error_active"),ee(P,!1,H),R(L)})),g.addEventListener("submit",(function(t){var r,n;t.preventDefault(),z(P,!0),K(T,"popup__error_active"),(r=x.value,n=j.value,fetch("".concat(e.url,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:r,link:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка добавления карточки: ".concat(e.status,". Попробуйте ещё раз."))}))).then((function(e){var t=Y(e,o,re,oe,ne);A.prepend(t),W(L)})).catch((function(e){console.log(e),I(T,"popup__error_active",e)})).finally((function(){z(P,!1)}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){return function(e,t){var r=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);r.forEach((function(r){r.addEventListener("input",(function(){ee(o,e.checkValidity(),t),function(e,t,r){var o=t.querySelector(".".concat(e.id,"-error"));e.validity.valid?$(e,o,r):function(e,t,r){e.classList.add(r.inputErrorClass),t.classList.add(r.textErrorClass),t.textContent=e.validationMessage}(e,o,r)}(r,e,t)}))}))}(t,e)}))}(H)})();