(()=>{"use strict";var e,t,o,r={url:"https://mesto.nomoreparties.co/v1/wbf-cohort-5",headers:{"Content-Type":"application/json",authorization:"96531009-4ee7-4854-9cab-762893291a9b"}},n=document.querySelector(".page"),c=n.querySelector(".content"),a=(n.querySelector(".root"),n.querySelector(".popup_type_edit-profile")),u=c.querySelector(".profile__btn-edit"),i=a.querySelector(".form"),s=i.querySelector(".form__input_type_profile-name"),l=i.querySelector(".form__input_type_profile-description"),d=a.querySelector(".popup__btn_type_form"),p=a.querySelector(".popup__error"),_=c.querySelector(".profile__title"),f=c.querySelector(".profile__subtitle"),y=n.querySelector(".popup_type_update-avatar"),m=c.querySelector(".profile__avatar-btn-add"),v=c.querySelector(".profile__avatar"),h=y.querySelector(".form"),S=y.querySelector(".form__input_type_avatar-url"),q=y.querySelector(".popup__btn_type_form"),b=y.querySelector(".popup__error"),k=n.querySelector(".popup_type_add-photo"),E=c.querySelector(".profile__btn-add"),L=k.querySelector(".form"),C=k.querySelector(".form__input_type_photo-name"),x=k.querySelector(".form__input_type_photo-url"),g=k.querySelector(".popup__btn_type_form"),j=k.querySelector(".popup__error"),P=c.querySelector(".gallery__cards"),T=document.querySelector("#card-item-template").content,A=n.querySelector(".popup_type_viewer-photo"),w=A.querySelector(".viewer__photo"),B=A.querySelector(".viewer__caption"),D=n.querySelector(".popup_type_confirm"),N=D.querySelector(".popup__btn_type_confirm"),O=D.querySelector(".popup__error"),J={formSelector:".form",inputSelector:".form__input",inputErrorClass:"form__input_error",textErrorClass:"form__error_active",submitButtonSelector:".popup__btn_type_form",inactiveButtonClass:"popup__btn_disabled"};function G(e,t,o){e.textContent=o,e.disabled=!!t&&"disabled"}function H(e,t){G(e,t,t?"Сохранение...":"Сохранить")}function M(e,t){e.classList.add("popup__error_active"),e.textContent=t}function z(e){e.classList.remove("popup__error_active"),e.textContent=""}function U(e){"Escape"===e.key&&F(n.querySelector(".popup_opened"))}function V(e){e.classList.add("popup_opened"),document.body.classList.add("root_popup-open"),document.addEventListener("keydown",U)}function F(e){e.classList.remove("popup_opened"),document.body.classList.remove("root_popup-open"),document.removeEventListener("keydown",U)}function I(e,t,o,n){var c=T.querySelector(".card").cloneNode(!0);e.element=c;var a=c.querySelector(".card__photo"),u=c.querySelector(".card__text"),i=c.querySelector(".card__btn-like"),s=c.querySelector(".card__like-counter"),l=c.querySelector(".card__btn-delete");return a.src=e.link,a.setAttribute("alt",e.name),u.textContent=e.name,s.textContent=e.likes.length,a.addEventListener("click",(function(){o(e)})),function(e,t){return e.likes.some((function(e){return e._id===t}))}(e,t)&&i.classList.add("card__btn-like_active"),i.addEventListener("click",(function(){var t;i.classList.contains("card__btn-like_active")?(t=e._id,fetch("".concat(r.url,"/cards/likes/").concat(t),{method:"DELETE",headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка удаления лайка: ".concat(e.status," ").concat(e.statusText))}))).then((function(e){i.classList.remove("card__btn-like_active"),s.textContent=e.likes.length})).catch((function(e){return console.log(e)})):function(e){return fetch("".concat(r.url,"/cards/likes/").concat(e),{method:"PUT",headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка установки лайка: ".concat(e.status," ").concat(e.statusText))}))}(e._id).then((function(e){i.classList.add("card__btn-like_active"),s.textContent=e.likes.length})).catch((function(e){return console.log(e)}))})),function(e,t){return e.owner._id===t}(e,t)?l.addEventListener("click",(function(){n(e,c)})):l.remove(),c}function K(e,t,o){e.classList.remove(o.inputErrorClass),t.classList.remove(o.textErrorClass),t.textContent=e.validationMessage}function Q(e,t,o){t?(e.disabled=!1,e.classList.remove(o.inactiveButtonClass)):(e.disabled="disabled",e.classList.add(o.inactiveButtonClass))}function R(e,t){e.querySelectorAll(".form__input").forEach((function(o){K(o,e.querySelector(".".concat(o.id,"-error")),t)}))}function W(e){w.src=e.link,w.setAttribute("alt",e.name),B.textContent=e.name,V(A)}function X(o,r){e=o,t=r,z(O),V(D)}function Y(e){_.textContent=e}function Z(e){f.textContent=e}function $(e){v.src=e}n.querySelectorAll(".popup").forEach((function(e){e.querySelector(".popup__btn-close").addEventListener("click",(function(){return F(e)})),e.addEventListener("mousedown",(function(t){t.target===e&&F(e)}))})),N.addEventListener("click",(function(){var o;G(N,!0,"Удаление..."),z(O),(o=e._id,fetch("".concat(r.url,"/cards/").concat(o),{method:"DELETE",headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка удаления карточки: ".concat(e.status,". Попробуйте ещё раз."))}))).then((function(){t.remove(),F(D)})).catch((function(e){console.log(e),M(O,e)})).finally((function(){return G(N,!1,"Да")}))})),Promise.all([fetch("".concat(r.url,"/users/me"),{method:"GET",headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка получения данных профиля: ".concat(e.status," ").concat(e.statusText))})),fetch("".concat(r.url,"/cards"),{method:"GET",headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка получения карточек: ".concat(e.status," ").concat(e.statusText))}))]).then((function(e){var t=e[0];o=t._id,$(t.avatar),Y(t.name),Z(t.about),e[1].forEach((function(e){var t=I(e,o,W,X);P.append(t)}))})).catch((function(e){return console.log(e)})),u.addEventListener("click",(function(){s.value=_.textContent,l.value=f.textContent,R(i,J),z(p),Q(d,!1,J),V(a)})),i.addEventListener("submit",(function(e){var t,o;e.preventDefault(),H(d,!0),z(p),(t=s.value,o=l.value,fetch("".concat(r.url,"/users/me"),{method:"PATCH",headers:r.headers,body:JSON.stringify({name:t,about:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка обновления профиля: ".concat(e.status,". Попробуйте ещё раз."))}))).then((function(e){Y(e.name),Z(e.about),F(a)})).catch((function(e){console.log(e),M(p,e)})).finally((function(){H(d,!1)}))})),m.addEventListener("click",(function(){h.reset(),R(h,J),z(b),Q(q,!1,J),V(y)})),h.addEventListener("submit",(function(e){var t;e.preventDefault(),H(q,!0),z(b),(t=S.value,fetch("".concat(r.url,"/users/me/avatar"),{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка обновления аватара: ".concat(e.status,". Попробуйте ещё раз."))}))).then((function(e){$(e.avatar),F(y)})).catch((function(e){console.log(e),M(b,e)})).finally((function(){H(q,!1)}))})),E.addEventListener("click",(function(){L.reset(),R(L,J),z(j),Q(g,!1,J),V(k)})),L.addEventListener("submit",(function(e){var t,n;e.preventDefault(),H(g,!0),z(j),(t=C.value,n=x.value,fetch("".concat(r.url,"/cards"),{method:"POST",headers:r.headers,body:JSON.stringify({name:t,link:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка добавления карточки: ".concat(e.status,". Попробуйте ещё раз."))}))).then((function(e){var t=I(e,o,W,X);P.prepend(t),F(k)})).catch((function(e){console.log(e),M(j,e)})).finally((function(){H(g,!1)}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){return function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);o.forEach((function(o){o.addEventListener("input",(function(){Q(r,e.checkValidity(),t),function(e,t,o){var r=t.querySelector(".".concat(e.id,"-error"));e.validity.valid?K(e,r,o):function(e,t,o){e.classList.add(o.inputErrorClass),t.classList.add(o.textErrorClass),t.textContent=e.validationMessage}(e,r,o)}(o,e,t)}))}))}(t,e)}))}(J)})();