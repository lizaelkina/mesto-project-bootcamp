(()=>{"use strict";var e,t,n,o={url:"https://mesto.nomoreparties.co/v1/wbf-cohort-5",headers:{"Content-Type":"application/json",authorization:"96531009-4ee7-4854-9cab-762893291a9b"}},r=document.querySelector(".root"),c=document.querySelector(".page"),a=document.querySelector(".content"),u=c.querySelector(".popup_type_edit-profile"),i=a.querySelector(".profile__btn-edit"),s=u.querySelector(".form"),l=s.querySelector(".form__input_type_profile-name"),d=s.querySelector(".form__input_type_profile-description"),p=u.querySelector(".popup__btn_type_form"),_=u.querySelector(".popup__error"),f=a.querySelector(".profile__title"),m=a.querySelector(".profile__subtitle"),y=c.querySelector(".popup_type_update-avatar"),v=a.querySelector(".profile__avatar-btn-add"),h=a.querySelector(".profile__avatar"),S=y.querySelector(".form"),q=y.querySelector(".form__input_type_avatar-url"),b=y.querySelector(".popup__btn_type_form"),E=y.querySelector(".popup__error"),k=c.querySelector(".popup_type_add-photo"),L=a.querySelector(".profile__btn-add"),C=k.querySelector(".form"),x=k.querySelector(".form__input_type_photo-name"),g=k.querySelector(".form__input_type_photo-url"),j=k.querySelector(".popup__btn_type_form"),P=k.querySelector(".popup__error"),T=a.querySelector(".gallery__cards"),A=document.querySelector("#card-item-template").content,w=c.querySelector(".popup_type_viewer-photo"),B=w.querySelector(".viewer__photo"),D=w.querySelector(".viewer__caption"),N=c.querySelector(".popup_type_confirm"),O=N.querySelector(".popup__btn_type_confirm"),J=N.querySelector(".popup__error"),G={formSelector:".form",inputSelector:".form__input",inputErrorClass:"form__input_error",textErrorClass:"form__error_active",submitButtonSelector:".popup__btn_type_form",inactiveButtonClass:"popup__btn_disabled"};function H(e,t,n){e.textContent=n,e.disabled=!!t&&"disabled"}function M(e,t){H(e,t,t?"Сохранение...":"Сохранить")}function z(e,t){e.classList.add("popup__error_active"),e.textContent=t}function U(e){e.classList.remove("popup__error_active"),e.textContent=""}function V(e){"Escape"===e.key&&I(c.querySelector(".popup_opened"))}function F(e){e.classList.add("popup_opened"),r.classList.add("root_popup-open"),document.addEventListener("keydown",V)}function I(e){e.classList.remove("popup_opened"),r.classList.remove("root_popup-open"),document.removeEventListener("keydown",V)}function K(e,t,n,r){var c=A.querySelector(".card").cloneNode(!0);e.element=c;var a=c.querySelector(".card__photo"),u=c.querySelector(".card__text"),i=c.querySelector(".card__btn-like"),s=c.querySelector(".card__like-counter"),l=c.querySelector(".card__btn-delete");return a.src=e.link,a.setAttribute("alt",e.name),u.textContent=e.name,s.textContent=e.likes.length,a.addEventListener("click",(function(){n(e)})),function(e,t){return e.likes.some((function(e){return e._id===t}))}(e,t)&&i.classList.add("card__btn-like_active"),i.addEventListener("click",(function(){var t;i.classList.contains("card__btn-like_active")?(t=e._id,fetch("".concat(o.url,"/cards/likes/").concat(t),{method:"DELETE",headers:o.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка удаления лайка: ".concat(e.status," ").concat(e.statusText))}))).then((function(e){i.classList.remove("card__btn-like_active"),s.textContent=e.likes.length})).catch((function(e){return console.log(e)})):function(e){return fetch("".concat(o.url,"/cards/likes/").concat(e),{method:"PUT",headers:o.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка установки лайка: ".concat(e.status," ").concat(e.statusText))}))}(e._id).then((function(e){i.classList.add("card__btn-like_active"),s.textContent=e.likes.length})).catch((function(e){return console.log(e)}))})),function(e,t){return e.owner._id===t}(e,t)?l.addEventListener("click",(function(){r(e,c)})):l.remove(),c}function Q(e,t,n){e.classList.remove(n.inputErrorClass),t.classList.remove(n.textErrorClass),t.textContent=e.validationMessage}function R(e,t,n){t?(e.disabled=!1,e.classList.remove(n.inactiveButtonClass)):(e.disabled="disabled",e.classList.add(n.inactiveButtonClass))}function W(e,t){e.querySelectorAll(".form__input").forEach((function(n){Q(n,e.querySelector(".".concat(n.id,"-error")),t)}))}function X(e){B.src=e.link,B.setAttribute("alt",e.name),D.textContent=e.name,F(w)}function Y(n,o){e=n,t=o,U(J),F(N)}function Z(e){f.textContent=e}function $(e){m.textContent=e}function ee(e){h.src=e}c.querySelectorAll(".popup").forEach((function(e){e.querySelector(".popup__btn-close").addEventListener("click",(function(){return I(e)})),e.addEventListener("mousedown",(function(t){t.target===e&&I(e)}))})),O.addEventListener("click",(function(){var n;H(O,!0,"Удаление..."),U(J),(n=e._id,fetch("".concat(o.url,"/cards/").concat(n),{method:"DELETE",headers:o.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка удаления карточки: ".concat(e.status,". Попробуйте ещё раз."))}))).then((function(){t.remove(),I(N)})).catch((function(e){console.log(e),z(J,e)})).finally((function(){return H(O,!1,"Да")}))})),Promise.all([fetch("".concat(o.url,"/users/me"),{method:"GET",headers:o.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка отображения данных: ".concat(e.status,". Попробуйте перезагрузить страницу."))})),fetch("".concat(o.url,"/cards"),{method:"GET",headers:o.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка отображения данных: ".concat(e.status,". Попробуйте перезагрузить страницу."))}))]).then((function(e){var t=e[0];n=t._id,ee(t.avatar),Z(t.name),$(t.about),e[1].forEach((function(e){var t=K(e,n,X,Y);T.append(t)}))})).catch((function(e){console.log(e),function(e){a.classList.add("content_inactive");var t=document.createElement("section");t.classList.add("content__error"),t.textContent=e,a.prepend(t)}(e)})),i.addEventListener("click",(function(){l.value=f.textContent,d.value=m.textContent,W(s,G),U(_),R(p,!1,G),F(u)})),s.addEventListener("submit",(function(e){var t,n;e.preventDefault(),M(p,!0),U(_),(t=l.value,n=d.value,fetch("".concat(o.url,"/users/me"),{method:"PATCH",headers:o.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка обновления профиля: ".concat(e.status,". Попробуйте ещё раз."))}))).then((function(e){Z(e.name),$(e.about),I(u)})).catch((function(e){console.log(e),z(_,e)})).finally((function(){M(p,!1)}))})),v.addEventListener("click",(function(){S.reset(),W(S,G),U(E),R(b,!1,G),F(y)})),S.addEventListener("submit",(function(e){var t;e.preventDefault(),M(b,!0),U(E),(t=q.value,fetch("".concat(o.url,"/users/me/avatar"),{method:"PATCH",headers:o.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка обновления аватара: ".concat(e.status,". Попробуйте ещё раз."))}))).then((function(e){ee(e.avatar),I(y)})).catch((function(e){console.log(e),z(E,e)})).finally((function(){M(b,!1)}))})),L.addEventListener("click",(function(){C.reset(),W(C,G),U(P),R(j,!1,G),F(k)})),C.addEventListener("submit",(function(e){var t,r;e.preventDefault(),M(j,!0),U(P),(t=x.value,r=g.value,fetch("".concat(o.url,"/cards"),{method:"POST",headers:o.headers,body:JSON.stringify({name:t,link:r})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка добавления карточки: ".concat(e.status,". Попробуйте ещё раз."))}))).then((function(e){var t=K(e,n,X,Y);T.prepend(t),I(k)})).catch((function(e){console.log(e),z(P,e)})).finally((function(){M(j,!1)}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){return function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){n.addEventListener("input",(function(){R(o,e.checkValidity(),t),function(e,t,n){var o=t.querySelector(".".concat(e.id,"-error"));e.validity.valid?Q(e,o,n):function(e,t,n){e.classList.add(n.inputErrorClass),t.classList.add(n.textErrorClass),t.textContent=e.validationMessage}(e,o,n)}(n,e,t)}))}))}(t,e)}))}(G)})();